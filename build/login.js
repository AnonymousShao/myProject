var authentication={};$(document).ready(function(){authentication={isImg:!1,iputObj:null,customer:null,init:function(t){1!=localStorage.getItem("unActive")&&"trigger"!=t.type||(authentication.keyState(),localStorage.getItem("userId")&&authentication.show(t))},enterCertification:function(t){authentication.customer=localStorage.getItem("userId"),authentication.callBack=t,authentication.firstSubmit(),authentication.secondSubmit(),authentication.third()},callBack:{},keyState:function(){var t="";if(localStorage.getItem("userId"))if(localStorage.getItem("approveInfo"))t=JSON.parse(localStorage.getItem("approveInfo"));else{var e={customerId:localStorage.getItem("userId"),isValid:"1"};e={paramJson:$.toJSON(e)},$.ajax({url:"//www.yi-ding.net.cn/call/yiding/customer/auth/getMapById/",type:"GET",dataType:"json",async:!1,data:e,success:function(e){e.responseObject.responseStatus?(localStorage.setItem("approveInfo",JSON.stringify(e.responseObject.responseData.data_list[0].customerAuth)),t=JSON.parse(localStorage.getItem("approveInfo"))):(localStorage.setItem("approveInfo",JSON.stringify({state:"-1"})),t=JSON.parse(localStorage.getItem("approveInfo")))},error:function(t,e,a){}})}return t},show:function(t){var e=authentication.keyState().state;switch(parseInt(e)){case-1:if(authentication.keyState().fullName){var a=authentication.keyState().baseName,i=a.length>0;i||(authentication.rejectPage(),t&&t.before&&t.before(),authentication.enterCertification(t)),i&&(authentication.rejectPage(),t&&t.before&&t.before(),authentication.enterCertification(t))}else authentication.rejectPage(),t&&t.before&&t.before(),authentication.enterCertification(t);break;case 0:return void comm.alertBox({title:"很抱歉！我们正在加紧审核您的认证信息，请耐心等待...",ensure:"好的",ensureCallback:function(){localStorage.setItem("unActive",0),localStorage.getItem("allinUrl")?(window.location.href=localStorage.getItem("allinUrl"),localStorage.removeItem("allinUrl")):t.reload&&t.reload&&window.location.reload()}});case 1:return;case 2:return;case 3:return authentication.rejectPage(!0),t&&t.before&&t.before(),authentication.enterCertification(t),!1;case 4:return void comm.alertBox({title:"很抱歉！我们正在加紧审核您的认证信息，请耐心等待...",ensure:"好的",ensureCallback:function(){localStorage.setItem("unActive",0),localStorage.getItem("allinUrl")?(window.location.href=localStorage.getItem("allinUrl"),localStorage.removeItem("allinUrl")):t.reload&&window.location.reload()}})}},rejectPage:function(t){function e(t){if(t.length>0)for(var e=t.split(","),a=[],i=0;i<e.length;i++)a[i]={},a[i].title=e[i].substring(e[i].indexOf("_")+1),a[i].id=e[i].substring(0,e[i].indexOf("_"));return a}comm.maskBackground.show("rgba(0,0,0,.6)");var a=$(".yd-maskBackground"),i='<section class="authentication-out">    <!--验证默认-->    <section class="authentication authentication1" style="display: display:none;">        <section class="width">            <aside class="Jurisdiction">                <div class="userNormal"><img src="/image/authority/authentication/renzheng.png"></div>                <div class="rz-after">认证后<br>                    你将拥有全部课程观看、讨论、下载权限</div>                <div class="authNone">暂不认证</div>            </aside>         <section class="authorityCommon">            <header class="title">                <div class="authorityTitle">医师认证</div>            </header>            <aside class="rzInput">                <div class="titleInput clear marginTop">                    <div class="titleText">姓名</div>                    <input class="titleType input-name" placeholder="请输入姓名">                </div>                <!--专业选中-->                <div class="titleInput clear marginTop" style="display: none;">                    <div class="titleText">专业</div>                    <ul class="checkboxXl input-checkbox">                        <!--<li><span style="margin:0;">小儿骨科</span><i class="ev-tagClose" tagid="5">X</i></li>-->                    </ul>                    <section class="yd-tagSelectorBox hide al-header-pcModule Ev-professionalBox">                        <header class="yd-tagSelectorBoxTitle">选择专业领域<span class="yd-tagSelectorBoxCloseBtn">X</span></header>                        <section class="yd-tagSelectorItem">                            <!--<button>关节</button>-->                        </section>                        <footer class="yd-tagSelectorBoxFootBtn">                            <button class="yd-personalAdviceSubmit Ev-professionalSure">确定</button>                            <button class="yd-personalAdviceCancel Ev-professionalCancel">取消</button>                        </footer>                    </section>                </div>                <!--专业选中 end-->                <!--专业默认-->                <div class="titleInput clear marginTop">                    <div class="titleText">专业</div>                    <input class="titleType" placeholder="请选择专业">                </div>                <!--专业默认 end-->                <!--下拉列表参考 //www.allinmd.cn/pages/personal/customerInfo.html-->                <!--职称选中-->                <div class="titleInput clear marginTop" style="display: none;">                    <div class="titleText title-technical">职称</div>                    <div class="technical input-technical"></div>                    <section class="al-tagSelectorBox ev-medicalBox" style="display: none;">                        <header class="al-tagSelectorBoxTitle">选择职称<span class="al-tagSelectorBoxCloseBtn ev-medCancel">X</span></header>                        <section class="al-tagSelectorItem ev-medicalConList al-tagSelectorItem1">                            <article class="al-tagSelectorList tagSelectorList1">                            </article>                            <article class="al-tagSelectorList hide tagSelectorList2" style="display: none;">                            </article>                            <article class="al-tagSelectorList hide tagSelectorList3" style="display: none;">                            </article>                        </section>                        <footer class="al-tagSelectorBoxFootBtn">                            <button class="al-personalAdviceSubmit ev-medSave">确定</button>                            <button class="al-personalAdviceCancel ev-medCancel">取消</button>                        </footer>                    </section>                </div>                <!--职称选中 end-->                <!--职称默认-->                <div class="titleInput clear marginTop">                    <div class="titleText">职称</div>                    <input class="titleType" placeholder="请选择职称">                </div>                <!--职称默认 end-->                <div class="titleInput clear marginTop hospital">                    <div class="titleText">就职医院</div>                    <input class="titleType input-hospital" placeholder="请输入就职医院">                    <ul class="set-down hospitalDown" style="display: none;"></ul>                </div>                <div class="titleInput clear base">                    <div class="titleText">住培基地</div>                    <input class="titleType input-base" placeholder="请输入住培基地">                    <ul class="set-down baseDown" style="display: none;"></ul>                </div>            </aside>            <!--激活按钮添加 类名 （activation）-->            <div class="loginBtn">继续</div>        </section>    </section>    </section>    <!--验证默认 END-->    <!--认证工作表-->    <section class="authentication authentication-Style2" style="display:none ;">        <section class="width">         <section class="authorityCommon">            <header class="title" style="display: none;">                <div class="authorityTitle">医师认证</div>                <div class="errortipHeader"><span>当前网络环境不佳，上传失败</span></div>            </header>            <aside class="authenticationStyle">                <div class="clear">                    <div class="styleTitle">认证类型：</div>                    <figure class="selectBorder"><span class="authenticationType"></span>                        <ul class="authenticationList"></ul>                    </figure>                </div>                <div class="pitchOn" style="visibility: hidden;">工作证</div>                <section class="titleInput clear marginTop authenticationNum1">                    <div class="titleText authenticationNum">证件编号</div>                    <input class="titleType" placeholder="请输入证件编号（选填）">                </section>                <div class="uploadPhoto clear">                    <div class="leftNormalImg" id="file"><img src="/image/authority/authentication/auth_uploadphoto.png"> <span>上传认证照片</span>                        <div class="againPopup" style="display: none;">                            <div class="againPopupBg"></div>                            <div class="againPopupText">重新上传</div>                        </div>                        <form class="uploadIcon uploadPic" method="POST" enctype="multipart/form-data">                            <input type="file" name="file" class="authenticationFile" multiple="" id="myfile">                        </form>                    </div>                    <div class="rightNormalImg"><img src="/image/authority/authentication/sample_degree.png"> <span>示例</span></div>                </div>            </aside>            <!--激活按钮添加 类名 （activation）-->            <div class="loginBtn">提交</div>        </section>    </section>    </section>    <!--认证工作表 END-->    <!--认证拒绝-->    <section class="authentication authentication3" style="display:none ;">        <section class="width">         <section class="authorityCommon">            <header class="refuseTitle">认证拒绝</header>            <aside class="refuseText">您提交的认证资料未通过审核，请修改后重新提交</aside>            <div class="loginBtn activation">重新认证</div>            <div class="authenticationNone">暂不认证</div>        </section>    </section>   </section>    <!--认证拒绝 end--></section>';a.html(i),$(".authentication1").hide(),authentication.iputObj=$(".yd-maskBackground .titleInput");var n=authentication.keyState();if(n.fullName){$(".input-name").val(n.fullName),$(".input-hospital").val(n.company),n.baseName?($(".input-base").val(n.baseName),t?($(".authentication3").show(),commLog.createBrowse(23,"医师认证-认证拒绝页",window.location.href)):($(".authentication-Style2").show(),commLog.createBrowse(15,"医师认证-认证类型页（认证第二步)",window.location.href))):($(".authentication1").show(),commLog.createBrowse(14,"医师认证-认证基本信息页（认证第一步)",window.location.href));for(var o=e(n.areasExpertise),c=e(n.medicalTitle),l="",s="",r=0;r<o.length;r++)l+='<li><span style="margin:0;">'+o[r].title+'</span><i class="ev-tagClose" tagid="'+o[r].id+'">X</i></li>';for(var r=0;r<c.length;r++)s+='<li><span style="margin:0;">'+c[r].title+'</span><i class="ev-tagClose" tagid="'+c[r].id+'">X</i></li>';$(".input-checkbox").html(l),$(".input-technical").html(s),$(".yd-maskBackground .titleInput").eq(1).show(),$(".yd-maskBackground .titleInput").eq(3).show(),$(".yd-maskBackground .titleInput").eq(2).hide(),$(".yd-maskBackground .titleInput").eq(4).hide()}else $(".authentication1").show(),commLog.createBrowse(14,"医师认证-认证基本信息页（认证第一步)",window.location.href),$(".yd-maskBackground .titleInput").eq(1).hide(),$(".yd-maskBackground .titleInput").eq(3).hide()},firstSubmit:function(){authentication.authenticationInint(),$(".authNone").off("click").on("click",function(){commLog.creatEvent({id:16,url:window.location.href,keyword:"暂不认证"}),$(".yd-confirmModalMask.yd-alertModalMask").remove(),comm.confirmBox({title:"确认放弃认证吗？",content:"放弃认证，将无法：</br>浏览完整系列课程</br>参与课程问答",cancel:"放弃",ensure:"继续认证",ensureCallback:function(){},cancelCallback:function(){$(".yd-confirmModalMask").remove(),$(".yd-maskBackground").remove(),localStorage.setItem("unActive",0),localStorage.getItem("allinUrl")?(window.location.href=localStorage.getItem("allinUrl"),localStorage.removeItem("allinUrl")):authentication.callBack.reload&&window.location.href.indexOf("course")==-1&&location.reload()}})}),$(".authentication1 .loginBtn").removeClass("activation"),$(".input-name").click(function(){authentication.hideSetDown(),authentication.medicalTitleBtn(),authentication.tagSelectorBoxCloseBtn()}),$(".input-name").blur(function(){authentication.inputName($(this))}),authentication.iputObj.eq(2).click(function(){authentication.checkBox()}),authentication.iputObj.eq(2).find("input").on("keyup",function(){authentication.checkBox()}),$(".checkboxXl").click(function(){authentication.checkBox()}),$(".yd-personalAdviceCancel").click(authentication.tagSelectorBoxCloseBtn),$(".yd-personalAdviceSubmit").click(authentication.tagSelectorBoxCloseBtn),$(".yd-tagSelectorBoxCloseBtn").click(authentication.tagSelectorBoxCloseBtn),authentication.iputObj.eq(4).find("input").on("keyup",function(){authentication.technical()}),authentication.iputObj.eq(4).click(function(){authentication.technical()}),$(".technical").off("click").on("click",function(t){t.stopPropagation(),t.preventDefault(),authentication.technical()}),$(".al-personalAdviceSubmit").click(authentication.medicalTitleBtn),$(".al-tagSelectorBoxCloseBtn").click(authentication.medicalTitleBtn),$(".al-personalAdviceCancel").click(authentication.medicalTitleBtn),authentication.inputChange(),$(".input-hospital").on("mouseout",function(){$(".hospitalDown").hide()}),$(".hospitalDown").on("mouseover",function(){$(".hospitalDown").show()}),$(".input-base").on("mouseout",function(){$(".baseDown").hide()}),$(".baseDown").on("mouseover",function(){$(".baseDown").show()}),authentication.loginBtn()},authenticationInint:function(){var t={isValid:"1",treeLevels:"1,2",platformId:"1",firstResult:"0",maxResult:"20"};t={paramJson:$.toJSON(t)},authentication.ajaxRequest("//www.yi-ding.net.cn/call/comm/data/baseinfo/getTagList/",t,"GET",function(t){for(var e=t.responseObject.responseData.data_list,a=0;a<e.length;a++){var i=$("<button></button>");i.text(e[a].tagName),i.attr("tagid",e[a].id),$(".yd-tagSelectorItem").append(i)}});var e={isValid:"1",typeId:"2",roleId:"7",visitSiteId:"13"};e={paramJson:$.toJSON(e)},authentication.ajaxRequest("//www.yi-ding.net.cn/call/comm/data/baseinfo/getRoleConfigList/",e,"GET",function(t){for(var e=t.responseObject.responseData.data_list,a="",i="",n="",o=0;o<e.length;o++)1==e[o].sortId?a+='<span class="ev-medicalLiList" select-status="false" medicalid="'+e[o].refId+'">'+e[o].refValue+"</span>":2==e[o].sortId?i+='<span class="ev-medicalLiList" select-status="false" medicalid="'+e[o].refId+'">'+e[o].refValue+"</span>":3==e[o].sortId&&(n+='<span class="ev-medicalLiList" select-status="false" medicalid="'+e[o].refId+'">'+e[o].refValue+"</span>");a+='<span class="ev-medicalLiList" select-status="false" medicalid="0">其他</span>',$(".authentication1 .tagSelectorList1").html(a),$(".authentication1 .tagSelectorList2").html(i),$(".authentication1 .tagSelectorList3").html(n)})},inputName:function(t){var e=t.val();if(e.length>0)if(/^\s|^\.|^\▪|^\·|\s$|\.$|\▪$|\·$/.test(e)){$(".authentication1 .errortipHeader1").remove();var a="<div class='errortipHeader1'><span>请输入正确的名字</span></div>";$(".authentication1").append(a),$(".authentication1 .loginBtn").removeClass("activation")}else if(/^[\u4e00-\u9fa5\s\.\▪\·]{1,25}$|^[A-Za-z\s\.\▪\·]{1,50}$|^([A-Za-z\s\.\▪\·]|[\u4e00-\u9fa5\s\.\▪\·]){1,50}$/.test(e)){for(var i=0;i<e.length;i++)if(" "==e[i]&&" "==e[i+1]){$(".authentication1 .errortipHeader1").remove();var a="<div class='errortipHeader1'><span>请输入正确的名字</span></div>";return $(".authentication1").append(a),void $(".authentication1 .loginBtn").removeClass("activation")}$(".authentication1 .errortipHeader1").remove(),authentication.loginBtnActive()}else{$(".authentication1 .errortipHeader1").remove();var a="<div class='errortipHeader1'><span>请输入正确的名字</span></div>";$(".authentication1").append(a),$(".authentication1 .loginBtn").removeClass("activation")}else $(".authentication1 .errortipHeader1").remove(),$(".authentication1 .loginBtn").removeClass("activation")},checkBox:function(){if(authentication.hideSetDown(),authentication.medicalTitleBtn(),"none"==$(".ev-medicalBox").css("display")){authentication.iputObj.eq(1).show(),authentication.iputObj.eq(2).hide();var t=$(".al-header-pcModule .yd-tagSelectorItem button");t.removeClass("active");for(var e=$(".input-checkbox li"),a=0;a<e.length;a++)for(var i=0;i<t.length;i++)t.eq(i).text()==e.eq(a).find("span").text()&&t.eq(i).addClass("active");$(".al-header-pcModule").show();for(var n=0,a=1;a<t.length;a++)t.eq(a).hasClass("active")&&n++;n==t.length-1&&t.eq(0).addClass("active"),t.each(function(){$(this).unbind("click").bind("click",function(){$(this).toggleClass("active");var t=$(this).hasClass("active"),e="1"==$(this).attr("tagid");if(t){var a=$(".yd-tagSelectorItem button");if(e)a.addClass("active");else{for(var i=0,n=1;n<a.length;n++)a.eq(n).hasClass("active")&&i++;i==a.length-1&&a.eq(0).addClass("active")}}else if(e){var o=$(".yd-tagSelectorItem button");$(".yd-tagSelectorItem button").removeClass("active")}else{var o=$(".yd-tagSelectorItem button");o.eq(0).removeClass("active")}})}),$(".al-header-pcModule .yd-personalAdviceCancel").off("click").on("click",function(){commLog.creatEvent({id:22,url:window.location.href,keyword:"专业返回",browseType:"17",browseTypeSourceUrl:window.location.href}),$(".al-header-pcModule").hide(),$(".al-header-pcModule .yd-tagSelectorItem button").removeClass("active");for(var e=$(".input-checkbox li"),a=0;a<e.length;a++)for(var i=0;i<t.length;i++)t.eq(i).text()==e.eq(a).find("span").text()&&t.eq(i).addClass("active");authentication.tagSelectorBoxCloseBtn()}),$(".al-header-pcModule .yd-personalAdviceSubmit").off("click").on("click",function(){commLog.creatEvent({id:23,url:window.location.href,keyword:"专业保存",browseType:"17",browseTypeSourceUrl:window.location.href}),$(".al-header-pcModule").hide();var e="";$("#professionalName01").val("");for(var a=0;a<t.length;a++)if(t.eq(a).hasClass("active")&&0!=a){var i=t.eq(a).text(),n=t.eq(a).attr("tagid");e+='<li><span style="margin:0;">'+i+'</span><i class="ev-tagClose" tagid="'+n+'">X</i></li>'}$(".input-checkbox").html(e),$(".input-checkbox li .ev-tagClose").off("click").on("click",function(){$(this).parents("li").remove();for(var e=$(this).parents("li").find("span").text(),a=0;a<t.length;a++)t.eq(a).text()==e&&t.eq(a).removeClass("active");t.eq(0).removeClass("active"),authentication.tagSelectorBoxCloseBtn()}),authentication.tagSelectorBoxCloseBtn()}),$(".al-header-pcModule .yd-tagSelectorBoxCloseBtn").off("click").on("click",function(){commLog.creatEvent({id:22,url:window.location.href,keyword:"专业返回",browseType:"17",browseTypeSourceUrl:window.location.href}),$(".al-header-pcModule").hide(),$(".al-header-pcModule .yd-tagSelectorItem button").removeClass("active");for(var e=$(".input-checkbox li"),a=0;a<e.length;a++)for(var i=0;i<t.length;i++)t.eq(i).text()==e.eq(a).find("span").text()&&t.eq(i).addClass("active");authentication.tagSelectorBoxCloseBtn()})}},technical:function(){if(authentication.hideSetDown(),"none"==$(".al-header-pcModule").css("display")){authentication.iputObj.eq(3).show(),authentication.iputObj.eq(4).hide();var t=$(".al-tagSelectorBox .ev-medicalLiList"),e=$(".al-tagSelectorBox .tagSelectorList1 .ev-medicalLiList"),a=$(".al-tagSelectorBox .tagSelectorList2 .ev-medicalLiList"),i=$(".al-tagSelectorBox .tagSelectorList3 .ev-medicalLiList");t.removeClass("active");for(var n=$(".input-technical li span"),o=0;o<t.length;o++)for(var c=0;c<n.length;c++)n.eq(c).text()==t.eq(o).text()&&t.eq(o).addClass("active");$(".ev-medicalBox").show(),e.each(function(){$(this).unbind("click").bind("click",function(){"其他"!=$(this).text()?$(this).hasClass("active")?$(this).removeClass("active"):("医学生"==$(this).text()||"住院医师"==$(this).text()||"主治医师"==$(this).text()?(t.removeClass("active"),$(".al-tagSelectorBox .tagSelectorList2").hide(),$(".al-tagSelectorBox .tagSelectorList3").hide()):(e.removeClass("active"),$(".al-tagSelectorBox .tagSelectorList2").show(),$(".al-tagSelectorBox .tagSelectorList3").show()),$(this).addClass("active")):($(".al-tagSelectorBox .tagSelectorList2").show(),$(".al-tagSelectorBox .tagSelectorList3").show())})}),a.each(function(){$(this).unbind("click").bind("click",function(){$(this).hasClass("active")?$(this).removeClass("active"):(a.removeClass("active"),$(this).addClass("active"))})}),i.each(function(){$(this).unbind("click").bind("click",function(){$(this).hasClass("active")?$(this).removeClass("active"):(i.removeClass("active"),$(this).addClass("active"))})}),$(".al-tagSelectorBox .al-personalAdviceSubmit").off("click").on("click",function(){commLog.creatEvent({id:21,url:window.location.href,keyword:"职称保存",browseType:"16",browseTypeSourceUrl:window.location.href}),$(".ev-medicalBox").hide();for(var e="",a=0;a<t.length;a++)t.eq(a).hasClass("active")&&(e+='<li><span style="margin:0;">'+t.eq(a).text()+'</span><i class="ev-tagClose" tagid="'+t.eq(a).attr("medicalid")+'">X</i></li>');$(".input-technical").html(e),authentication.medicalTitleBtn()}),$(".al-tagSelectorBox .al-personalAdviceCancel").off("click").on("click",function(){commLog.creatEvent({id:20,url:window.location.href,keyword:"职称返回",browseType:"16",browseTypeSourceUrl:window.location.href}),$(".ev-medicalBox").hide(),t.removeClass("active");for(var e=$(".input-technical li span"),a=0;a<t.length;a++)for(var i=0;i<e.length;i++)e.eq(i).text()==t.eq(a).text()&&t.eq(a).addClass("active");authentication.medicalTitleBtn()}),$(".al-tagSelectorBox .al-tagSelectorBoxCloseBtn").off("click").on("click",function(){commLog.creatEvent({id:20,url:window.location.href,keyword:"职称返回",browseType:"16",browseTypeSourceUrl:window.location.href}),$(".ev-medicalBox").hide(),t.removeClass("active");for(var e=$(".input-technical li span"),a=0;a<t.length;a++)for(var i=0;i<e.length;i++)e.eq(i).text()==t.eq(a).text()&&t.eq(a).addClass("active");authentication.medicalTitleBtn()}),$(".input-technical li .ev-tagClose").off("click").on("click",function(){$(this).parents("li").remove();for(var e=$(this).parents("li").find("span").text(),a=0;a<t.length;a++)t.eq(a).text()==e&&t.eq(a).removeClass("active");authentication.medicalTitleBtn()})}},secondSubmit:function(){authentication.renzheng(),$(".authentication-Style2 .title").hide(),$(".pitchOn").css("visibility","hidden"),$(".pitchOn").html(""),$(".authentication-Style2 .againPopup").hide(),$(".pitchOn").click(function(){$(".authentication-Style2 .selectBorder").show()}),$(".authentication-Style2 .loginBtn").removeClass("activation"),authentication.imgLoad(),$(".authenticationNum1 .titleType").unbind("keyup").bind("keyup",function(){var t=$(this).val();if(t.length>0)if(/^[A-Za-z0-9]{1,50}$/.test(t)){$(".authentication-Style2  .errortipHeader1").remove();var e=$(".pitchOn").text();authentication.isImg&&""!=e&&$(".authentication-Style2 .loginBtn").addClass("activation")}else{$(".authentication-Style2  .errortipHeader1").remove();var a="<div class='errortipHeader1'><span>请输入正确的证件编号</span></div>";$(".authentication-Style2  ").append(a),$(".authentication-Style2 .loginBtn").removeClass("activation")}else{var e=$(".pitchOn").text();authentication.isImg&&""!=e&&$(".authentication-Style2 .loginBtn").addClass("activation"),$(".authentication-Style2  .errortipHeader1").remove()}})},third:function(){$(".authentication3 .loginBtn").on("click",function(){commLog.creatEvent({id:27,url:window.location.href,keyword:"重新认证",browseType:"23",browseTypeSourceUrl:window.location.href}),$(".authentication3").hide(),$(".authentication1").show(),commLog.createBrowse(14,"医师认证-认证基本信息页（认证第一步)",window.location.href),authentication.iputObj.eq(1).show(),authentication.iputObj.eq(3).show(),authentication.iputObj.eq(2).hide(),authentication.iputObj.eq(4).hide(),authentication.loginBtnActive()}),$(".authentication3 .authenticationNone").off("click").on("click",function(){comm.confirmBox({title:"确认放弃认证吗？",content:"放弃认证，将无法：</br>浏览完整系列课程</br>参与课程问答",cancel:"放弃",ensure:"继续认证",ensureCallback:function(){},cancelCallback:function(){commLog.creatEvent({id:16,url:window.location.href,keyword:"暂不认证"}),$(".yd-confirmModalMask").remove(),$(".yd-maskBackground").remove(),localStorage.setItem("unActive",0),localStorage.getItem("allinUrl")?(window.location.href=localStorage.getItem("allinUrl"),localStorage.removeItem("allinUrl")):authentication.callBack.reload&&window.location.href.indexOf("course")==-1&&location.reload()}})})},imgLoad:function(){$("#myfile").unbind("change").bind("change",function(){var t=$(this).val().split(".")[1].toUpperCase();if("BMP"==t||"PNG"==t||"GIF"==t||"JPG"==t||"JPEG"==t){var e=commLog.getBrowserInfo(),a="",i="";if(e&&(a=(e+"").replace(/[^0-9.]/gi,""),i=(e+"").replace(/[^a-zA-Z]/gi,"")+","+a),"msie,8.0"==i){var n="<figure class='yd-loading1'><img src='/image/personal/loading_big@2x.png' alt=''><p>上传中</p></figure>";$(".authentication-Style2").css({position:"relative"}),$(".authentication-Style2").append(n);var o=($(".authentication-Style2 .titleType").val(),$(".authenticationFile").val(),{imageType:"2",customerId:authentication.customer,visitSiteId:"13"});o={paramJson:$.toJSON(o)},$(this).parent().ajaxSubmit({url:"//www.yi-ding.net.cn/call/yiding/upload/attachment/upload/",dataType:"text",data:o,type:"post",clearForm:!0,success:function(t){authentication.uploadImg(t)},error:function(){$(".yd-loading1").remove(),authentication.isImg=!1,$(".againPopup").show(),$(".authentication-Style2 .loginBtn").removeClass("activation")}})}else{var c=this.files[0].size/1048576;if(c<5){var n="<figure class='yd-loading1'><img src='/image/personal/loading_big@2x.png' alt=''><p>上传中</p></figure>";$(".authentication-Style2").css({position:"relative"}),$(".authentication-Style2").append(n);var o=($(".authentication-Style2 .titleType").val(),$(".authenticationFile").val(),{imageType:"2",customerId:authentication.customer,visitSiteId:"13"});o={paramJson:$.toJSON(o)},$(this).parent().ajaxSubmit({url:"//www.yi-ding.net.cn/call/yiding/upload/attachment/upload/",dataType:"text",data:o,type:"post",clearForm:!0,success:function(t){authentication.uploadImg(t)},error:function(){$(".yd-loading1").remove(),authentication.isImg=!1,$(".againPopup").show(),$(".authentication-Style2 .loginBtn").removeClass("activation")}})}else popup({text:"图片不能大于5MB"})}}else popup({text:"图片限于bmp,png,gif,jpg,jpeg格式"})})},uploadImg:function(t){$(".yd-loading1").remove(),popup({hasImg:!0,text:"上传成功"});var e=$.parseJSON(t.replace(/<.*?>/gi,""));if(e.responseObject.responseStatus){authentication.isImg=!0;var a=$(".pitchOn").text(),i=$(".authentication-Style2 .errortipHeader1").length;authentication.isImg&&""!=a&&0==i&&$(".authentication-Style2 .loginBtn").addClass("activation");var n=e.responseObject.responseMessage.url;$(".leftNormalImg>img").attr({src:n}),$(".authenticationFile").attr("filePathAth",e.responseObject.responseMessage.path),$(".authentication-Style2 .loginBtn").click(function(){commLog.creatEvent({id:19,url:window.location.href,keyword:"认证第二步提交"});var t=$(".authentication-Style2 .errortipHeader1").length,e=$(".pitchOn").attr("pitchonid"),a=$(".pitchOn").text(),i=$(".authentication-Style2 .titleType").val(),n=$(".authenticationFile").attr("filepathAth"),o={customerId:authentication.customer,attType:e,attCode:i,attPath:n,visitSiteId:"0",opflag:"2"},c={paramJson:$.toJSON(o)};if(authentication.isImg&&""!=a&&0==t){var l="//www.yi-ding.net.cn/call/yiding/customer/auth/createAuth/";authentication.ajaxRequest(l,c,"post",function(t){authentication.saveSucess(t.responseObject)})}else $(".authentication-Style2 .loginBtn").removeClass("activation")})}else $(".authentication-Style2 .title").show(),$(".againPopup").show()},loginBtnActive:function(){var t=$(".input-name").val(),e=($(".input-checkbox").text(),$(".input-technical li").length),a=$(".input-hospital").val(),i=$(".input-base").val(),n=$(".authentication1 .errortipHeader1").length,o=$(".input-checkbox li").length;""!=t&&o>0&&0!=e&&""!=a&&""!=i&&0==n?$(".authentication1 .loginBtn").addClass("activation"):$(".authentication1 .loginBtn").removeClass("activation")},loginBtn:function(){$(".authentication1 .loginBtn").click(function(){commLog.creatEvent({id:17,url:window.location.href,keyword:"认证第一步提交"});for(var t=$(".authentication1 .errortipHeader1").length,e=$(".input-name").val(),a=($(".input-checkbox").text(),""),i=0;i<$(".input-checkbox li").length;i++){var n=$(".input-checkbox li i")[i].getAttribute("tagid")+"_"+$(".input-checkbox li span")[i].innerText+",";a+=n}for(var o=a.slice(0,a.length-1),c=$(".input-technical li").length,l="",i=0;i<c;i++){var s=$(".input-technical li i")[i].getAttribute("tagid")+"_"+$(".input-technical li span")[i].innerText;"_"!=s&&(l+=s+",")}var r=l.slice(0,l.length-1),u=$(".input-hospital").val(),d=$(".input-base").val(),h=$(".input-checkbox li").length,p=$(".input-hospital").attr("tagid")||0,g=$(".input-base").attr("tagId")||0,v=authentication.keyState().state,m={customerId:authentication.customer,fullName:e,areasExpertise:o,medicalTitle:r,companyId:p,company:u,baseId:g,baseName:d,state:v,visitSiteId:"0",opflag:"1"};localStorage.setItem("keyNext",JSON.stringify(m));var f={paramJson:$.toJSON(m)};if(""!=e&&h>0&&0!=c&&""!=u&&""!=d&&0==t){var y="//www.yi-ding.net.cn/call/yiding/customer/auth/createAuth/";authentication.ajaxRequest(y,f,"post",function(t){authentication.nextSubmit(t.responseObject,f)})}else $(this).removeClass("activation")})},ajaxRequest:function(t,e,a,i){$.ajax({url:t,type:a,dataType:"json",data:e,success:function(t){i(t)},error:function(t,e,a){}})},renzheng:function(){var t={visitSiteId:"13",isValid:"1",roleId:"6"};t={paramJson:$.toJSON(t)};var e=$(".authenticationList"),a="//www.yi-ding.net.cn/call/comm/data/baseinfo/getRoleConfigList/";authentication.ajaxRequest(a,t,"GET",function(t){for(var a=t.responseObject.responseData.data_list,i="",n=0;n<a.length;n++){var o=a[n].refValue;i+="<li ydauthenId="+a[n].refId+">"+o+"</li>"}e.html(i),authentication.clickInput("renzheng")})},creatCheckboxLi:function(t,e,a){var i=$("<li><span style='margin:0;'></span><i class='ev-tagClose' tagid=''>X</i></li>");a?(i.find("span").text(e.split("_")[1]),i.find("i").attr("tagid",e.split("_")[0])):i.find("span").text(e),t.append(i),authentication.creatActive()},hideSetDown:function(){$(".baseDown").hide(),$(".hospitalDown").hide()},medicalTitleBtn:function(){$(".ev-medicalBox").hide(),""==$(".technical").text()?(authentication.iputObj.eq(4).show(),authentication.iputObj.eq(4).find("input").val(""),authentication.iputObj.eq(3).hide(),$(".authentication1 .loginBtn").removeClass("activation")):authentication.loginBtnActive()},tagSelectorBoxCloseBtn:function(){$(".al-header-pcModule").hide(),0==$(".checkboxXl li").length?(authentication.iputObj.eq(2).show(),authentication.iputObj.eq(2).find("input").val(""),authentication.iputObj.eq(1).hide(),$(".authentication1 .loginBtn").removeClass("activation")):authentication.loginBtnActive()},clickInput:function(t){switch(t){case"base":$(".baseDown li").each(function(){$(this).unbind("click").bind("click",function(){var t=$(this).html();if(t.length>0){$(".baseDown").hide();$(".input-base").attr("tagId",$(this).attr("tagid"));$(this).parent().prev().val(t)}})});break;case"hospital":$(".hospitalDown li").each(function(){$(this).unbind("click").bind("click",function(){commLog.creatEvent({id:25,url:window.location.href,keyword:"医院选择"});var t=$(this).html();if(t.length>0){$(".hospitalDown").hide();$(".input-hospital").attr("tagId",$(this).attr("tagid"));$(this).parent().prev().val(t)}})});break;case"renzheng":$(".authenticationList li").each(function(){$(this).unbind("click").bind("click",function(){var t=$(this).html(),e=$(this).attr("ydauthenid");if(t.length>0){$(".authentication-Style2 .selectBorder").hide();var a=$(".authentication-Style2 .errortipHeader1").length;switch($(".pitchOn").html(t),authentication.isImg&&0==a&&$(".authentication-Style2 .loginBtn").addClass("activation"),$(".pitchOn").attr("pitchOnId",e),$(".pitchOn").css("visibility","visible"),"工作证"==$(".pitchOn").text()||"学生证"==$(".pitchOn").text()?($(".authenticationNum1").hide(),$(".authenticationNum1 input").val(""),$(".authentication-Style2  .errortipHeader1").remove()):$(".authenticationNum1").show(),
$(".pitchOn").text()){case"工作证":$(".rightNormalImg img").attr("src","/image/authority/authentication/sample_employee.png");break;case"学生证":$(".rightNormalImg img").attr("src","/image/authority/authentication/sample_student.png");break;case"医师执业证":$(".rightNormalImg img").attr("src","/image/authority/authentication/sample_Doctor.png");break;case"医师资格证":$(".rightNormalImg img").attr("src","/image/authority/authentication/sample_Doctor.png");break;case"医学学位证":$(".rightNormalImg img").attr("src","/image/authority/authentication/sample_degree.png");break;case"医学学历证":$(".rightNormalImg img").attr("src","/image/authority/authentication/sample_degree.png")}}})})}},inputChange:function(){var t=$(".input-hospital"),e=$(".hospitalDown"),a=$(".baseDown"),i=$(".input-base");t.unbind("keyup").bind("keyup",function(){authentication.loginBtnActive();var t=$(this).val();t=encodeURI(t);var a={hospitalName:t,isValid:"1",firstResult:"0",maxResult:"10"};if(a={paramJson:$.toJSON(a)},e.show(),t.length>0){var i="//www.yi-ding.net.cn/call/comm/data/baseinfo/getHospitalList/";authentication.ajaxRequest(i,a,"GET",function(t){if(t.responseObject.responseStatus){var a=t.responseObject.responseData.data_list;if(""==t.responseObject.responseMessage){for(var i="",n=0;n<a.length;n++){var o=a[n].hospitalName;i+="<li tagId='"+a[n].id+"'>"+o+"</li>"}e.html(i),authentication.clickInput("hospital"),e.show()}else e.hide()}})}else e.hide()}),i.unbind("keyup").bind("keyup",function(){authentication.loginBtnActive();var t=$(this).val();t=encodeURI(t);var e={baseName:t,isValid:"1",firstResult:"0",maxResult:"10"};if(e={paramJson:$.toJSON(e)},a.show(),t.length>0){var i="//www.yi-ding.net.cn/call/comm/data/baseinfo/getBaseList/";authentication.ajaxRequest(i,e,"GET",function(t){if(t.responseObject.responseStatus){var e=t.responseObject.responseData.data_list;if(""==t.responseObject.responseMessage){for(var i="",n=0;n<e.length;n++){var o=e[n].baseName;i+="<li tagId='"+e[n].id+"'>"+o+"</li>"}a.html(i),authentication.clickInput("base"),a.show()}else a.hide()}})}else a.hide()})},nextSubmit:function(t,e){t.responseStatus?1==t.responseData.registType&&1==t.responseData.state?(authentication.exit(),loginAbout.changeHead(),authentication.callBack.success&&authentication.callBack.success()):($(".authentication1 .loginBtn").addClass("activation"),$(".authentication").eq(0).hide(),$(".authentication").eq(1).show(),commLog.createBrowse(15,"医师认证-认证类型页（认证第二步)",window.location.href)):($(".authentication3").show(),$(".authentication1").hide())},saveSucess:function(t,e){if(t.responseStatus){if(localStorage.getItem("approveInfo")){var a=authentication.keyState().state;authentication.saveReqState(a)}authentication.exit(),loginAbout.changeHead(),authentication.callBack.success&&authentication.callBack.success()}},saveReqState:function(t){switch(t){case"-1":break;case"0":break;case"1":break;case"2":break;case"3":comm.alertBox({mTitle:"",title:"我们已经收到您的认证资料，审核周期为3-5个工作日，请耐心等待!<br>谢谢您的配合",ensure:"好的",ensureCallback:function(){}});break;case"4":}},exit:function(t){$(".yd-maskBackground").remove();var e={customerId:localStorage.getItem("userId"),isValid:"1"};e={paramJson:$.toJSON(e)},$.ajax({url:"//www.yi-ding.net.cn/call/yiding/customer/auth/getMapById/",type:"GET",dataType:"json",async:!1,data:e,success:function(t){t.responseObject.responseStatus?(localStorage.setItem("approveInfo",JSON.stringify(t.responseObject.responseData.data_list[0].customerAuth)),userApproveInfo=JSON.parse(localStorage.getItem("approveInfo"))):(localStorage.setItem("approveInfo",JSON.stringify({state:"-1"})),userApproveInfo=JSON.parse(localStorage.getItem("approveInfo")))},error:function(t,e,a){}}),t&&t()}},authentication.init({type:""}),authentication.keyState()});
var loginFn={isValid:{phone:!0,pass:!0,code:!0,quiPhone:!0,quiCode:!0,fidPhone:!0,fidCode:!0,bidWeiPhone:!0,bidWeiCode:!0,restPass:!0,restPass2:!0,weiBtnReg:!1,caosPhone:!0,caosPas:!0,caosNum:!0,caosCode:!0,fidcodeKey:0,fidCustomerId:0,quicodeKey:0,quiCustomerId:0,quiValidCode:0,quiCrePass:0,bidValidCode:0,bidcodeKey:0,bidWeiPass:0,userId:0,logCliNum:0,fidPhoneNum:0,fidSendCodeNum:0,quiPhoneNum:0,quiSendCodeNum:0,regcodeKey:0,bidWeiNum:0,sendBinWei:0,weiUrl:1},path:{isExist:"//www.yi-ding.net.cn/call/yiding/web/user/isExist/",login:"//www.yi-ding.net.cn/call/passport/securitycheck",sendCode:"//www.yi-ding.net.cn/call/yiding/customer/send/code/create/",checkCode:"//www.yi-ding.net.cn/call/yiding/customer/send/code/update/",updataPass:"//www.yi-ding.net.cn/call/yiding/web/user/update_passwd/",mobLogin:"//www.yi-ding.net.cn/call/yiding/web/user/userLogin/",weixinBind:"//www.yi-ding.net.cn/call/yiding/interact/loginBind/",userId:"//www.yi-ding.net.cn/call/yiding/web/user/getWebUser/",islogin:"//www.yi-ding.net.cn/call/yiding/web/user/checkSession/",allinLogin:"//www.yi-ding.net.cn/call/yiding/web/user/bindAllin/",register:"//www.yi-ding.net.cn/call/yiding/web/user/userRegist/"},init:function(e){var i=this;i.objFn=e,i.clearNum($(".ev-phoneNum")),i.clearPass($(".ev-passWord")),i.eyeOpen(),i.finPas(),i.quiLog(),i.allinBingLogin(),i.returnText(),i.hisPhone(),i.checkLogin(),i.weixin(),i.checkBidLogin(),i.close()},ajaxFn:function(e){$.ajax({type:e.type,url:e.url,data:{paramJson:$.toJSON(e.param)},async:e.async,dataType:"json",jsonp:"callback",success:function(i){comm.loading.hide(),i&&e.fn(i)},error:function(e){},beforeSend:function(){comm.loading.show()}})},toast:function(e,i,n){setTimeout(function(){$(".errorTip").fadeIn(),$(".errorTip span").text(e),setTimeout(function(){$(".errorTip").fadeOut(),setTimeout(function(){$(".errorTip").removeClass("errorTipLong")},1e3)},n)},i)},clearNum:function(e){e.on("focus",function(){var i=$(this).val();$(".password").css("display","none"),i?($(".phone").css("display","inline-block"),$(".phone .close").on("click",function(){var i=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(i)},1e3)},100);e.attr("value",""),$(".phone").css("display","none"),$(".ev-loginBtn").removeClass("activation"),$(".ev-quiLoginBtn").removeClass("activation"),$(".ev-fidNext").removeClass("activation"),$(".ev-passSave").removeClass("activation"),$(".ev-bindWeixinLogin").removeClass("activation")})):$(this).on("keyup",function(){$(this).val()?($(".phone").css("display","inline-block"),$(".phone .close").on("click",function(){e.attr("value",""),$(".phone").css("display","none"),$(".ev-loginBtn").removeClass("activation"),$(".ev-quiLoginBtn").removeClass("activation"),$(".ev-fidNext").removeClass("activation"),$(".ev-passSave").removeClass("activation"),$(".ev-bindWeixinLogin").removeClass("activation")})):$(".phone").css("display","none")})}),e.on("blur",function(){function i(){var i=!1;$(".phone .close").on("click",function(){return i=!0}),setTimeout(function(){i?(e.attr("value",""),$(".phone").css("display","none"),setTimeout(function(){$(".errorTip").css("display","none")},400),$(".ev-loginBtn").removeClass("activation"),$(".ev-quiLoginBtn").removeClass("activation"),$(".ev-fidNext").removeClass("activation"),$(".ev-passSave").removeClass("activation"),$(".ev-bindWeixinLogin").removeClass("activation")):$(".phone").css("display","none")},200)}i(),function(){$(".isJump").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},100)}),$(".phone .close").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},100)}),$(".password .close").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},100)})}()})},clearPass:function(e){e.on("focus",function(){var i=$(this).val();$(".password").css("display","inline-block"),i?($(".password").css("display","inline-block"),$(".password .close").on("click",function(){setTimeout(function(){$(".errorTip").css("diaplay","none")},500),e.attr("value",""),$(".password").css("display","none"),$(".ev-loginBtn").removeClass("activation"),$(".ev-quiLoginBtn").removeClass("activation"),$(".ev-fidNext").removeClass("activation"),$(".ev-passSave").removeClass("activation"),$(".ev-bindWeixinLogin").removeClass("activation")})):($(".password .close").css("height","0"),$(this).on("keyup",function(){$(this).val()?($(".password").css("display","inline-block"),$(".close").css("height",""),$(".password .close").on("click",function(){e.attr("value",""),$(".password").css("display","none"),$(".ev-loginBtn").removeClass("activation"),$(".ev-quiLoginBtn").removeClass("activation"),$(".ev-fidNext").removeClass("activation"),$(".ev-passSave").removeClass("activation"),$(".ev-bindWeixinLogin").removeClass("activation")})):$(".password .close").css("height","0")}))}),e.on("blur",function(){function i(){var i=!1,n=!1;$(".password .close").on("click",function(){return i=!0}),$(".password .eyeClose").on("click",function(){n=!0}),$(".password .eyeOpen").on("click",function(){n=!0}),setTimeout(function(){i?(setTimeout(function(){$(".errorTip").css("diaplay","none")},500),e.attr("value",""),$(".password").css("display","none"),$(".ev-loginBtn").removeClass("activation"),$(".ev-quiLoginBtn").removeClass("activation"),$(".ev-fidNext").removeClass("activation"),$(".ev-passSave").removeClass("activation")):n?$(".password").css("display","inline-block"):$(".password").css("display","none")},200),$(".password .close").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".password .eyeClose").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".password .eyeOpen").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)})}i()})},eyeOpen:function(){$(".eyeOpen").on("click",function(){$(".password").css("display","inline-block"),$(this).css("display","none"),$(".eyeClose").css("display","inline-block"),$(".ev-passWord").prop("type","text"),$(".ev-caosPas").prop("type","text")}),$(".eyeClose").on("click",function(){$(".password").css("display","inline-block"),$(this).css("display","none"),$(".eyeOpen").css("display","inline-block"),$(".ev-passWord").prop("type","password"),$(".ev-caosPas").prop("type","password")})},hisPhone:function(){var e=this;if(localStorage.getItem("phoneNum"))for(var i=localStorage.getItem("phoneNum").split(","),n=i.length,o=0;o<n;o++){$(".history").css("display","block");var s="<li>"+i[o]+"</li>";$(".history").append(s),e.historyNum(),e.hisCli()}},hisCli:function(){var e=this;$(".history").on("click","li",function(){var i=$(this).text();$(".ev-phoneNum").val(i),$(".history").css("display","none"),e.hisPhone()})},historyNum:function(){$(".ev-phoneNum").on("keyup",function(){if($(this).val()&&localStorage.getItem("phoneNum"))for(var e=localStorage.getItem("phoneNum").split(","),i=0;i<e.length;i++)$(this).val()==e[i].substring(0,$(this).val().length)?($(".history").show(),$(".history li").eq(i).css("display","block")):($(".history").hide(),$(".history li").eq(i).css("display","none"))})},returnText:function(){"block"==$(".ev-login").css("display")&&$(".authorityBg").css("display","none");var e=this;$(".ev-findReturn").on("click",function(){$(".ev-login").css("display","block"),$(".ev-findPassword").css("display","none"),commLog.createBrowse(4,"登录注册-登录页"),$(".authorityBg").css("display","none")}),$(".ev-newReturn").on("click",function(){$(".ev-findPassword").css("display","block"),$(".ev-newPass").css("display","none"),commLog.createBrowse(5,"登录注册-找回密码页")}),$(".ev-quickReturn").on("click",function(){$(".ev-login").css("display","block"),$(".ev-quickLogin").css("display","none"),commLog.createBrowse(4,"登录注册-登录页"),$(".authorityBg").css("display","none")}),$(".ev-bindReturn").on("click",function(){$(".ev-createBind").css("display","block"),$(".ev-bindAllin").css("display","none"),commLog.createBrowse(10,"登录注册-唯医账号登录页")}),$(".ev-bindWeixinReturn").on("click",function(){window.location.href=localStorage.getItem("weiUrl"),loginAbout.login.exit(),comm.maskBackground.show("rgba(0,0,0,.6)");var i='<iframe src="'+e.path.weixinLogin+'" class="weixinLogin"\'>';$(".yd-maskBackground").html(i)})},sendCode:function(e,i,n){var o=this,s=60;e.off("click").on("click",function(){$(".validate").unbind("click");var a=window.location.href;"//www.yi-ding.net.cn/pages/authority/weixinBindLogin.html"==a.substring(a.indexOf("/"),a.length)&&commLog.creatEvent({id:160,url:window.location.href,keyword:"微信授权登录，微信绑定医鼎账号的发送验证码"});var t=i.val();o.isValid.fidSendCodeNum=t,o.isValid.quiSendCodeNum=t,o.isValid.sendBinWei=t,o.isValid.bidCaosSend=t,t?o.ajaxFn({url:o.path.sendCode,async:!1,param:{account:t,typeId:n,codeLength:4,createPasswd:1},type:"post",fn:function(a){var t=a.responseObject.responseData.codeNum;if(t||0==t){o.isValid.fidcodeKey=a.responseObject.responsePk,o.isValid.quicodeKey=a.responseObject.responsePk,o.isValid.bidcodeKey=a.responseObject.responsePk,o.isValid.regcodeKey=a.responseObject.responsePk,o.isValid.caosCodeKey=a.responseObject.responsePk,o.isValid.quiValidCode=a.responseObject.responseData.validCode,o.isValid.bidValidCode=a.responseObject.responseData.validCode,o.isValid.quiCrePass=a.responseObject.responseData.createPasswd,o.isValid.bidWeiPass=a.responseObject.responseData.createPasswd,o.isValid.bidCaosCodeKey=a.responseObject.responsePk;var c=setInterval(function(){s--,$(".validate").text(s+"s后重新获取"),$(".validate").css("color","#ccc"),$(".validate").unbind("click"),0==s&&(clearTimeout(c),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),o.sendCode(e,i,n)),$(".reg-experiencePo").off("click").on("click",function(){clearTimeout(c),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),loginAbout.register.exit(),o.sendCode(e,i,n)}),$(".log-experiencePo").off("click").on("click",function(){clearTimeout(c),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),loginAbout.login.exit(),o.sendCode(e,i,n)}),$(".ev-quickReturn").on("click",function(){clearTimeout(c),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),o.sendCode(e,i,n),$(".ev-login").css("display","block"),$(".ev-quickLogin").css("display","none"),commLog.createBrowse(4,"登录注册-登录页")}),$(".ev-findReturn").on("click",function(){clearTimeout(c),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),$(".ev-login").css("display","block"),$(".ev-findPassword").css("display","none"),commLog.createBrowse(4,"登录注册-登录页"),o.sendCode(e,i,n)}),$(".ev-bindReturn").on("click",function(){clearTimeout(c),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),o.sendCode(e,i,n),$(".ev-createBind").css("display","block"),$(".ev-bindAllin").css("display","none"),commLog.createBrowse(10,"登录注册-唯医账号登录页")})},1e3)}else o.toast("每日最多获取3次验证码,请明天再试",300,2e3)}}):o.toast("请填写正确的手机号",300,1500)})},finPas:function(){var e=this;$(".findPassword").off("click").on("click",function(){commLog.creatEvent({id:4,url:window.location.href,keyword:"找回密码"}),$(".ev-login").css("display","none"),$(".ev-findPassword").css("display","block"),commLog.createBrowse(5,"登录注册-找回密码页"),$(".authorityBg").css("display","block")}),e.clearNum($(".ev-findNum")),e.fidCheck()},fidCheckPhone:function(){var e=this;e.isValid.fidPhone=!0;var i=$(".ev-findNum"),n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i.val());0==o?e.isValid.fidPhone=!1:e.ajaxFn({url:e.path.isExist,type:"get",async:!1,param:{account:i.val()},fn:function(n){var o=n.responseObject.responseStatus;o?e.isValid.fidPhone=!1:(e.isValid.fidCustomerId=n.responseObject.responseData.customerUnite.customerId,e.isValid.fidPhoneNum=i.val())}})},fidCheckPhone2:function(){var e=this;e.isValid.fidPhone=!0;var i=$(".ev-findNum"),n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i.val());0==o?(e.toast("请填写正确手机号",300,1500),e.isValid.fidPhone=!1):e.ajaxFn({url:e.path.isExist,type:"get",async:!1,param:{account:i.val()},fn:function(n){var o=n.responseObject.responseStatus;o?(e.toast("该账号未注册",300,1500),e.isValid.fidPhone=!1):(e.isValid.fidCustomerId=n.responseObject.responseData.customerUnite.customerId,e.sendCode($(".ev-finValidate"),$(".ev-findNum"),1),e.isValid.fidPhoneNum=i.val())}})},fidCheckCode:function(){var e=this;e.isValid.fidCode=!0,null==$(".ev-fidCode").val()&&(e.isValid.fidCode=!1)},fidCheckCode2:function(){var e=this;e.isValid.fidCode=!0,null==$(".ev-fidCode").val()&&(e.toast("验证码不能为空",300,1500),e.isValid.fidCode=!1)},fidActive:function(){var e=this,i=$(".ev-findNum").val(),n=$(".ev-fidCode").val();i&&n&&e.isValid.fidPhone&&e.isValid.fidCode?($(".ev-fidNext").addClass("activation"),e.fidNextBtn()):($(".ev-fidNext").removeClass("activation"),$(".ev-fidNext").unbind("click"))},fidCheck:function(){var e=this;$(".ev-findNum").on("blur",function(){e.fidCheckPhone2(),e.fidActive()}),$(".ev-fidCode").on("blur",function(){e.fidCheckCode2(),e.fidActive()}),$(".ev-findNum").on("keyup",function(){e.fidCheckPhone(),e.fidActive()}),$(".ev-fidCode").on("keyup",function(){e.fidCheckCode(),e.fidActive()})},fidNextBtn:function(){var e=this;$(".ev-fidNext").off("click").on("click",function(){if(commLog.createBrowse(5,"登录注册-找回密码页"),$(this).is(".activation"))if(commLog.creatEvent({id:152,url:window.location.href,keyword:"找回密码下一步"}),e.isValid.fidPhoneNum!=e.isValid.fidSendCodeNum)e.toast("验证码输入错误",300,1500);else{var i=$(".ev-fidCode").val();e.ajaxFn({url:e.path.checkCode,type:"post",async:!1,param:{validCode:i,id:e.isValid.fidcodeKey},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;0==n?"1A0002"==o?e.toast("验证码错误,请重新获取",300,1500):"1A0001"==o&&e.toast("验证码已经失效,请重新获取",300,1500):($(".ev-newPass").css("display","block"),$(".ev-findPassword").css("display","none"),e.checkPas(),e.ajaxFn({url:e.path.checkCode,type:"post",async:!1,param:{validCode:o,id:e.isValid.fidcodeKey,isValid:0},fn:function(e){}}))}})}}),e.clearNum($(".ev-newPas")),e.clearPass($(".ev-conPas"))},checkPas1:function(){var e=this;e.isValid.restPass=!0;var i=/^[0-9a-zA-Z]*$/g,n=$(".ev-newPas").val(),o=n.length,s=i.test(n);s?o<6?e.isValid.restPass=!1:o>20&&(e.isValid.restPass=!1):e.isValid.restPass=!1},checkPas12:function(){var e=this,i=/^[0-9a-zA-Z]*$/g,n=$(".ev-newPas").val(),o=n.length,s=i.test(n);s?o<6?e.toast("密码长度少于6位",300,1500):o>20&&e.toast("密码长度超过20位",300,1500):e.toast("密码格式不正确",300,1500)},checkPas2:function(){var e=this;e.isValid.restPass2=!0;var i=/^[0-9a-zA-Z]*$/g,n=($(".ev-newPas").val(),$(".ev-conPas").val()),o=i.test(n),s=n.length;o?s<6?e.isValid.restPass2=!1:s>20&&(e.isValid.restPass2=!1):e.isValid.restPass2=!1},checkPas22:function(){var e=this,i=/^[0-9a-zA-Z]*$/g,n=($(".ev-newPas").val(),$(".ev-conPas").val()),o=i.test(n),s=n.length;o?s<6?e.toast("密码长度不足6位",300,1500):s>20&&e.toast("密码长度超过20位",300,1500):e.toast("密码格式不正确",300,1500)},checkPasActive:function(){var e=this,i=$(".ev-newPas").val(),n=$(".ev-conPas").val();i&&n&&e.isValid.restPass&&e.isValid.restPass2?($(".ev-passSave").addClass("activation"),e.savePass()):($(".ev-passSave").removeClass("activation"),$(".ev-passSave").unbind("click"))},checkPas:function(){var e=this;$(".ev-newPas").on("blur",function(){e.checkPas12(),e.checkPasActive()}),$(".ev-conPas").on("blur",function(){e.checkPas22(),e.checkPasActive()}),$(".ev-newPas").on("keyup",function(){e.checkPas1(),e.checkPasActive()}),$(".ev-conPas").on("keyup",function(){e.checkPas2(),e.checkPasActive()})},savePass:function(){var e=this;$(".ev-passSave").off("click").on("click",function(){if($(".ev-passSave").is(".activation")){commLog.creatEvent({id:153,url:window.location.href,keyword:"找回密码的提交"});var i=$(".ev-newPas").val(),n=$(".ev-conPas").val();if(i!=n)e.toast("两次输入密码不一致",300,1500);else{var o=$(".ev-newPas").val();e.ajaxFn({url:e.path.updataPass,type:"post",param:{customerId:e.isValid.fidCustomerId,passwd:o},fn:function(i){var n=i.responseObject.responseStatus;n&&($(".reset").css("display","block"),setTimeout(function(){$(".reset").css("display","none")},600),localStorage.setItem("userId",e.isValid.fidCustomerId),localStorage.setItem("userState","true"),loginAbout.login.exit(),loginAbout.changeHead(),e.objFn.success&&e.objFn.success())}})}}})},quiLog:function(){var e=this;$(".phoneLogin").off("click").on("click",function(){commLog.creatEvent({id:3,url:window.location.href,keyword:"手机快捷登录"}),$(".ev-login").css("display","none"),$(".ev-quickLogin").css("display","block"),e.quickCheck(),commLog.createBrowse(8,"登录注册-手机快捷登录页"),$(".authorityBg").css("display","block")}),e.clearNum($(".ev-quiNum"))},quiCheckPhone:function(){var e=this;e.isValid.quiPhone=!0;var i=$(".ev-quiNum");e.isValid.quiPhoneNum=i.val();var n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i.val());0==o&&(e.isValid.quiPhone=!1)},quiCheckPhone2:function(){var e=this;e.isValid.quiPhone=!0;var i=$(".ev-quiNum"),n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i.val());0==o?(e.toast("请填写正确手机号",300,1500),e.isValid.quiPhone=!1):e.ajaxFn({url:e.path.isExist,async:!1,param:{account:i.val()},type:"get",fn:function(i){var n=i.responseObject.responseStatus;0==n?e.sendCode($(".ev-quickCode"),$(".ev-quiNum"),3):e.sendCode($(".ev-quickCode"),$(".ev-quiNum"),2)}})},quiCheckCode:function(){var e=this;e.isValid.quiCode=!0,null==$(".ev-quiCode").val()&&(e.isValid.quiCode=!1)},quiCheckCode2:function(){var e=this;e.isValid.quiCode=!0,null==$(".ev-quiCode").val()&&(e.toast("验证码不能为空",300,1500),e.isValid.quiCode=!1)},quiActive:function(){var e=this,i=$(".ev-quiNum").val(),n=$(".ev-quiCode").val();i&&n&&e.isValid.quiPhone&&e.isValid.quiCode?($(".ev-quiLoginBtn").addClass("activation"),e.quiBtn()):($(".ev-quiLoginBtn").removeClass("activation"),$(".ev-quiLoginBtn").unbind("click"))},quickCheck:function(){var e=this;$(".ev-quiNum").on("blur",function(){e.quiCheckPhone2(),e.quiActive()}),$(".ev-quiCode").on("blur",function(){e.quiCheckCode2(),e.quiActive()}),$(".ev-quiNum").on("keyup",function(){e.quiCheckPhone(),e.quiActive()}),$(".ev-quiCode").on("keyup",function(){e.quiCheckCode(),e.quiActive()})},quiBtn:function(){var e=this;$(".ev-quiLoginBtn").off("click").on("click",function(){$(this).is(".activation")&&(e.isValid.quiPhoneNum!=e.isValid.quiSendCodeNum?e.toast("验证码输入错误",300,1500):e.ajaxFn({url:e.path.checkCode,type:"post",async:!1,param:{validCode:$(".ev-quiCode").val(),id:e.isValid.quicodeKey},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;if(0==n)"1A0002"==o?e.toast("验证码错误,请重新获取",300,1500):"1A0001"==o&&e.toast("验证码已经失效,请重新获取",300,1500);else{var s=$(".ev-quiNum").val();e.ajaxFn({url:e.path.isExist,type:"get",async:!1,param:{account:s},fn:function(i){var n=i.responseObject.responseStatus;e.isValid.quiCustomerId=i.responseObject.responseData.customerUnite.customerId,e.isValid.userId=i.responseObject.responseData.customerUnite.customerId;var o=i.responseObject.responseCode;if(n)"0B0010"==o&&comm.confirmBox({content:"该手机尚未注册<br/>是否直接创建新账号？",cancel:"取消",ensure:"创建账号",ensureCallback:function(){e.createNumBtn()},cancelCallback:function(){}});else{var s=$(".ev-quiNum").val(),o=e.isValid.quiValidCode,a=e.isValid.quicodeKey;e.ajaxFn({url:e.path.mobLogin,type:"post",async:!1,param:{loginType:"quickLogin",account:s,smsId:a,validCode:o},fn:function(i){if(i){var n=i.responseObject.responseStatus;if(n){if(commLog.creatEvent({id:147,url:window.location.href,keyword:"手机号快捷登录提交"}),localStorage.getItem("phoneNum"))for(var o=localStorage.getItem("phoneNum").split(","),a=0;a<o.length;a++)s!=o[a]&&localStorage.setItem("phoneNum",s+","+o);else localStorage.setItem("phoneNum",s);localStorage.setItem("userId",e.isValid.userId),loginAbout.login.exit(),loginAbout.changeHead(),localStorage.setItem("userState","true"),e.objFn.success&&e.objFn.success()}else e.objFn.error&&e.objFn.error()}}})}}})}}}))})},createNumBtn:function(){var e=this,i=$(".ev-quiCode").val();e.ajaxFn({url:e.path.checkCode,type:"post",async:!1,param:{validCode:i,id:e.isValid.quicodeKey},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;if(0==n)"1A0002"==o?e.toast("验证码错误,请重新获取",300,1500):"1A0001"==o&&e.toast("验证码已经失效,请重新获取",300,1500);else{var s=$(".ev-quiNum").val();e.ajaxFn({url:e.path.register,type:"get",param:{account:s,passwd:e.isValid.quiCrePass},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;if(e.isValid.userId=i.responseObject.responsePk,n)switch(o){case"0B0004":if(localStorage.setItem("userId",e.isValid.userId),localStorage.getItem("phoneNum"))for(var a=localStorage.getItem("phoneNum").split(","),t=0;t<a.length;t++)s!=a[t]&&localStorage.setItem("phoneNum",s+","+a);else localStorage.setItem("phoneNum",s);loginAbout.login.exit(),localStorage.setItem("userState","true"),loginAbout.changeHead(),e.objFn.success&&e.objFn.success()}else switch(o){case"9X0003":break;case"0B0001":}}})}}})},checkLoginPhone:function(){var e=this;e.isValid.phone=!0;var i=$(".ev-phoneNum"),n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i.val());0==o?e.isValid.phone=!1:e.ajaxFn({url:e.path.isExist,type:"get",async:!1,param:{account:i.val()},fn:function(i){var n=i.responseObject.responseStatus;n?e.isValid.phone=!1:e.isValid.userId=i.responseObject.responseData.customerUnite.customerId}})},checkLoginPhone2:function(){var e=this;e.isValid.phone=!0;var i=$(".ev-phoneNum"),n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i.val());0==o?(e.toast("请填写正确手机号",300,1500),e.isValid.phone=!1):e.ajaxFn({url:e.path.isExist,type:"get",async:!1,param:{account:i.val()},fn:function(i){var n=i.responseObject.responseStatus;n?(e.toast("该账号未注册",300,1500),e.isValid.phone=!1):e.isValid.userId=i.responseObject.responseData.customerUnite.customerId}})},checkLoginPass:function(){var e=this;e.isValid.pass=!0;var i=$(".ev-passWord"),n=/^[0-9a-zA-Z]*$/g,o=i.val().length,s=n.test(i.val());if(s){var o=i.val().length;o<6?e.isValid.pass=!1:o>20&&(e.isValid.pass=!1)}else e.isValid.pass=!1},checkLoginPass2:function(){var e=this;e.isValid.pass=!0;var i=$(".ev-passWord"),n=/^[0-9a-zA-Z]*$/g,o=i.val().length,s=n.test(i.val());if(s){var o=i.val().length;o<6?(e.toast("密码长度不足6位",300,1500),e.isValid.pass=!1):o>20&&(e.toast("密码长度超过20位",300,1500),e.isValid.pass=!1)}else e.toast("密码格式不正确",300,1500),e.isValid.pass=!1},activeLogin:function(){var e=this,i=$(".ev-phoneNum").val(),n=$(".ev-passWord").val();i&&n&&e.isValid.phone&&e.isValid.pass?($(".ev-loginBtn").addClass("activation"),e.loginBtn()):($(".ev-loginBtn").removeClass("activation"),$(".ev-loginBtn").unbind("click"))},checkLogin:function(){var e=this;$(".ev-phoneNum").on("blur",function(){setTimeout(function(){e.checkLoginPhone2(),$(".history li").css("display","none"),e.activeLogin(),e.historyNum()},200)}),$(".ev-passWord").on("blur",function(){e.checkLoginPass2(),e.activeLogin()}),$(".ev-phoneNum").on("keyup",function(){e.checkLoginPhone(),e.activeLogin()}),$(".ev-passWord").on("keyup",function(){e.checkLoginPass(),e.activeLogin()})},loginBtn:function(){var e=this;$(".ev-loginBtn").off("click").on("click",function(){if(commLog.creatEvent({id:2,url:window.location.href,keyword:"登录提交"}),$(this).is(".activation")){var i=$(".ev-phoneNum").val(),n=$(".ev-passWord").val();$.ajax({type:"post",url:e.path.login,data:{j_username:"website;"+i+";"+n+";mobile",j_password:n,rememberMe:!0},async:!1,dataType:"json",jsonp:"callback",beforeSend:function(){comm.loading.show()},success:function(n){if(comm.loading.hide(),n){var o=n.responseObject.responseStatus,s=n.responseObject.responseData.customerAuthState;if(o){var a=$(".ev-phoneNum").val(),t=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,c=t.test(a);if(localStorage.getItem("phoneNum"))for(var l=localStorage.getItem("phoneNum").split(","),r=0;r<l.length;r++)a!=l[r]&&c&&localStorage.setItem("phoneNum",i+","+l);else localStorage.setItem("phoneNum",i);localStorage.setItem("userAuth",s),localStorage.setItem("userId",e.isValid.userId),loginAbout.login.exit(),loginAbout.changeHead(),localStorage.setItem("userState","true"),e.objFn.success&&e.objFn.success()}else e.objFn.error&&e.objFn.error(),e.isValid.logCliNum++,e.isValid.logCliNum>=3&&setTimeout(function(){$(".prompt").fadeIn(),setTimeout(function(){$(".prompt").fadeOut()},3e3)},300),e.toast("密码错误",300,1500)}},error:function(e){}})}})},weixin:function(){var e=this;$(".weixin").off("click").on("click",function(){commLog.creatEvent({id:5,url:window.location.href,keyword:"微信登录"}),e.isValid.weiUrl=window.location.href,localStorage.setItem("weiUrl",window.location.href),loginAbout.login.exit(),comm.maskBackground.show("rgba(0,0,0,.6)");var i="<section class='weixinCloseContent'><section class='weixinClose'></section></section><iframe src=\"//open.weixin.qq.com/connect/qrconnect?appid=wx3b347620d468cd89&redirect_uri=https%3a%2f%2fwww.yi-ding.net.cn%2fcall%2fyiding%2finteract%2fweixinLogin%2f?url="+e.isValid.weiUrl+'&response_type=code&scope=snsapi_login&state=START#wechat_redirect" class="weixinLogin" ></iframe>';$(".yd-maskBackground").html(i),$(".weixinClose").on("click",function(){$(".yd-maskBackground").remove()})}),e.sendCode($(".ev-bindWeixinValidate"),$(".ev-bindWeixinNum"),2);var i=window.location.href;"//www.yi-ding.net.cn/pages/authority/weixinBindLogin.html?isFreeze=1"==i.substring(i.indexOf("/"),i.length)&&comm.alertBox({title:"账号已被冻结，请更换账号",ensure:"好的",ensureCallback:function(){loginAbout.register.exit(),loginAbout.login.exit(),window.location.href=localStorage.getItem("weiUrl")}}),"//www.yi-ding.net.cn/pages/authority/weixinBindLogin.html"==i.substring(i.indexOf("/"),i.length)&&commLog.createBrowse(11,"微信登录-账号绑定")},bidWeiCheckPhone:function(){var e=this;e.isValid.bidWeiPhone=!0;var i=$(".ev-bindWeixinNum").val(),n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i);e.isValid.bidWeiNum=i,0==o&&(e.isValid.bidWeiPhone=!1)},bidWeiCheckPhone2:function(){var e=this;e.isValid.bidWeiPhone=!0;var i=$(".ev-bindWeixinNum").val(),n=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=n.test(i);0==o?(e.toast("请输入正确的手机号",300,1500),e.isValid.bidWeiPhone=!1):e.ajaxFn({url:e.path.weixinBind,type:"post",async:!1,param:{account:$(".ev-bindWeixinNum").val(),isVerify:1},fn:function(i){i.responseObject.responseStatus,i.responseObject.responseCode;i.responseObject.responseStatus&&"0B0008"==i.responseObject.responseCode&&(e.toast("绑定的账号已经失效",300,1500),e.isValid.bidWeiPhone=!1)}})},bidWeiCheckCode:function(){var e=this;e.isValid.bidWeiCode=!0,""==$(".ev-bindWeixinCode").val()&&(e.isValid.bidWeiCode=!1)},bidWeiCheckCode2:function(){var e=this;e.isValid.bidWeiCode=!0,""==$(".ev-bindWeixinCode").val()&&(e.toast("验证码为空",300,1500),e.isValid.bidWeiCode=!1)},bidWeiActive:function(){var e=this,i=$(".ev-bindWeixinNum").val(),n=$(".ev-bindWeixinCode").val();i&&n&&e.isValid.bidWeiPhone&&e.isValid.bidWeiCode?($(".ev-bindWeixinLogin").addClass("activation"),e.bidWeiBtn()):($(".ev-bindWeixinLogin").removeClass("activation"),$(".ev-bindWeixinLogin").unbind("click"))},checkBidLogin:function(){var e=this;$(".ev-bindWeixinNum").on("blur",function(){e.bidWeiCheckPhone2(),e.bidWeiActive()}),$(".ev-bindWeixinCode").on("blur",function(){e.bidWeiCheckCode2(),e.bidWeiActive()}),$(".ev-bindWeixinNum").on("keyup",function(){e.bidWeiCheckPhone(),e.bidWeiActive()}),$(".ev-bindWeixinCode").on("keyup",function(){e.bidWeiCheckCode(),e.bidWeiActive()})},bidWeiBtn:function(){var e=this;$(".ev-bindWeixinLogin").off("click").on("click",function(){$(this).is(".activation")&&(commLog.creatEvent({id:155,url:window.location.href,keyword:"微信授权登录，微信绑定医鼎账号的提交"}),e.isValid.bidWeiNum!=e.isValid.sendBinWei?e.toast("验证码输入错误",300,1500):e.ajaxFn({url:e.path.weixinBind,type:"post",async:!1,param:{account:$(".ev-bindWeixinNum").val(),isVerify:1},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;if(n){var s=$(".ev-bindWeixinNum").val();e.ajaxFn({url:e.path.checkCode,type:"post",async:!1,param:{validCode:$(".ev-bindWeixinCode").val(),id:e.isValid.regcodeKey},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;0==n?"1A0002"==o?e.toast("验证码错误,请重新获取",300,1500):"1A0001"==o&&e.toast("验证码已经失效,请重新获取",300,1500):e.ajaxFn({url:e.path.weixinBind,type:"post",async:!1,param:{account:s,isVerify:0},fn:function(i){var n=i.responseObject.responseStatus;i.responseObject.responseCode;n&&(localStorage.setItem("userState","true"),localStorage.setItem("userId",e.isValid.fidCustomerId),loginAbout.changeHead(),window.location.href=localStorage.getItem("weiUrl"))}})}})}else switch(o){case"9X0004":e.weiBtnReg();break;case"0G0001":$(".errorTip").addClass("errorTipLong"),e.toast("绑定失败，账号已经绑定了其他的微信账号(可解除已绑定微信或更换手机号)",600,4e3)}}}))})},sendCodeCre:function(){var e=this,i=60,n=$(".ev-bindWeixinNum").val(),o=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;o.test(n);$(".ev-bindWeixinValidate").off("click").on("click",function(){commLog.creatEvent({id:160,url:window.location.href,keyword:"微信授权登录，微信绑定医鼎账号的发送验证码"}),n?e.ajaxFn({url:e.path.sendCode,async:!1,param:{account:n,typeId:2,codeLength:4,createPasswd:1},type:"post",fn:function(n){var o=n.responseObject.responseData.codeNum;if(e.isValid.bidcodeKey=n.responseObject.responsePk,e.isValid.bidWeiPass=n.responseObject.responseData.createPasswd,o||0==o)var s=setInterval(function(){i--,$(".validate").text(i+"s后重新获取"),$(".validate").css("color","#ccc"),$(".validate").unbind("click"),0==i&&(clearTimeout(s),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e")),$(".reg-experiencePo").off("click").on("click",function(){clearTimeout(s),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),loginAbout.register.exit()}),$(".log-experiencePo").off("click").on("click",function(){clearTimeout(s),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),loginAbout.login.exit()}),$(".ev-bindWeixinReturn").off("click").on("click",function(){clearTimeout(s),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),window.location.href=localStorage.getItem("weiUrl"),loginAbout.login.exit(),comm.maskBackground.show("rgba(0,0,0,.6)");var i='<iframe src="'+e.path.weixinLogin+'" class="weixinLogin"\'>';$(".yd-maskBackground").html(i)})},1e3);else e.toast("每日最多获取3次验证码,请明天再试",300,2e3)}}):e.toast("请填写正确的手机号",300,1500)})},weiBtnReg:function(){var e=this,i=$(".ev-bindWeixinCode").val();e.ajaxFn({url:e.path.checkCode,type:"post",async:!1,param:{validCode:i,id:e.isValid.regcodeKey},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;if(0==n)"1A0002"==o?e.toast("验证码错误,请重新获取",300,1500):"1A0001"==o&&e.toast("验证码已经失效,请重新获取",300,1500);else{var s=$(".ev-bindWeixinNum").val();e.ajaxFn({url:e.path.register,type:"get",param:{account:s,passwd:e.isValid.bidWeiPass,registType:2},fn:function(i){var n=i.responseObject.responseStatus,o=i.responseObject.responseCode;if(n)switch(o){case"0B0004":e.ajaxFn({url:e.path.weixinBind,type:"post",async:!1,param:{account:s,isVerify:0},fn:function(i){var n=i.responseObject.responseStatus;n?(localStorage.setItem("userId",e.isValid.fidCustomerId),localStorage.setItem("userState","true"),loginAbout.changeHead(),window.location.href=localStorage.getItem("weiUrl")):"0B0008"==o&&e.toast("绑定的账号已经失效",300,1500)}})}}})}}})},allinBingLogin:function(){$(".allin").on("click",function(){commLog.creatEvent({id:6,url:window.location.href,keyword:"唯医登录"}),commLog.createBrowse(10,"登录注册-唯医账号登录页"),localStorage.setItem("allinUrl",window.location.href),window.location.href="//www.allinmd.cn/pages/singlePage/user/yiding_authority.html"})},isLogin:function(){var e=this;e.ajaxFn({url:e.path.islogin,type:"post",async:!1,fn:function(e){var i=e.responseObject.responseStatus;i||($("#notLogin").css("display","inline-block"),
$("#isLogin").css("display","none"))}})},close:function(){$(".log-experiencePo").on("click",function(){loginAbout.login.exit()})}};
var registerFn={isValid:{customerId:"",phoneIsValid:!0,passIsValid:!0,codeIsValid:!0,server:!0,regcodeKey:0,phoneNum:0,sendCodeNum:0},path:{isExist:"//www.yi-ding.net.cn/call/yiding/web/user/isExist/",register:"//www.yi-ding.net.cn/call/yiding/web/user/userRegist/",sendCode:"//www.yi-ding.net.cn/call/yiding/customer/send/code/create/",checkCode:"//www.yi-ding.net.cn/call/yiding/customer/send/code/update/",profile:"//www.yi-ding.net.cn/call/site/profile/getMapById/"},init:function(e){var n=this;n.objFn=e,n.clearNum($(".ev-regNum")),n.clearPass($(".ev-regPas")),n.eyeOpen(),n.cancle(),n.check(),n.checkSer()},ajaxFn:function(e){$.ajax({type:e.type,url:e.url,data:{paramJson:$.toJSON(e.param)},async:e.async,dataType:"json",success:function(n){comm.loading.hide(),n&&e.fn(n)},error:function(e){},beforeSend:function(){comm.loading.show()}})},toast:function(e,n,s){$(".errorTip").fadeIn(),$(".errorTip span").text(e),setTimeout(function(){$(".errorTip").fadeOut(),$(".errorTip").removeClass("errorTipLong")},s)},clearNum:function(e){e.on("focus",function(){var n=$(this).val();$(".password").css("display","none"),n?($(".phone").css("display","inline-block"),$(".phone .close").on("click",function(){e.attr("value",""),$(".errorTip").css("display","none"),$(".phone").css("display","none")})):$(this).on("keyup",function(){$(this).val()?($(".phone").css("display","inline-block"),$(".phone .close").on("click",function(){e.attr("value",""),$(".phone").css("display","none")})):$(".phone").css("display","none")})}),e.on("blur",function(){function n(){var n=!1;$(".phone .close").on("click",function(){return n=!0}),n&&$(".errorTip").css("display","none"),setTimeout(function(){n?(e.attr("value",""),setTimeout(function(){$(".errorTip").css("display","none")},400),$(".phone").css("display","none")):$(".phone").css("display","none")},200)}n(),function(){$(".isJump").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".phone .close").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".password .close").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".password .eyeClose").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".password .eyeOpen").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)})}()})},clearPass:function(e){e.on("focus",function(){var n=$(this).val();$(".password").css("display","inline-block"),n?($(".password").css("display","inline-block"),$(".password .close").on("click",function(){e.attr("value",""),$(".password").css("display","none")})):($(".password .close").css("height","0"),$(this).on("keyup",function(){$(this).val()?($(".password").css("display","inline-block"),$(".close").css("height",""),$(".password .close").on("click",function(){e.attr("value",""),$(".password").css("display","none")})):$(".password .close").css("height","0")}))}),e.on("blur",function(){function n(){var n=!1,s=!1;$(".password .close").on("click",function(){return n=!0}),$(".password .eyeClose").on("click",function(){s=!0}),$(".password .eyeOpen").on("click",function(){s=!0}),setTimeout(function(){n?(setTimeout(function(){$(".errorTip").css("display","none")},400),e.attr("value",""),$(".password").css("display","none")):s?$(".password").css("display","inline-block"):$(".password").css("display","none")},200),$(".password .close").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".password .eyeClose").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)}),$(".password .eyeOpen").on("click",function(){var e=setInterval(function(){$(".errorTip").hide(),setTimeout(function(){clearInterval(e)},1e3)},10)})}n()})},eyeOpen:function(){$(".eyeOpen").on("click",function(){$(this).css("display","none"),$(".eyeClose").css("display","inline-block"),$(".ev-regPas").prop("type","text")}),$(".eyeClose").on("click",function(){$(this).css("display","none"),$(".eyeOpen").css("display","inline-block"),$(".ev-regPas").prop("type","password")})},cancle:function(){$(".reg-experiencePo").on("click",function(){$(".yd-alertModalMask").css("z-index",20),comm.confirmBox({title:"确定放弃注册吗?",content:"放弃注册,将无法:<br/>浏览完整系列课程<br/>参与课程讨论",cancel:"放弃",ensure:"继续注册",ensureCallback:function(){$(".yd-confirmModalMask").removeClass("show").remove()},cancelCallback:function(){loginAbout.register.exit()}})})},checkPhone:function(){var e=this;e.isValid.phoneIsValid=!0;var n=$(".ev-regNum"),s=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=s.test(n.val());0==o?e.isValid.phoneIsValid=!1:e.ajaxFn({url:e.path.isExist,async:!0,param:{account:n.val()},type:"get",fn:function(n){var s=n.responseObject.responseStatus;0==s?e.isValid.phoneIsValid=!1:e.sendCode()}})},checkPhone2:function(){var e=this;e.isValid.phoneIsValid=!0;var n=$(".ev-regNum"),s=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=s.test(n.val());0==o?(e.toast("请填写正确手机号",300,1500),e.isValid.phoneIsValid=!1):e.ajaxFn({url:e.path.isExist,async:!0,param:{account:n.val()},type:"get",fn:function(s){var o=s.responseObject.responseStatus;s.responseObject.responseCode;0==o?($(".yd-alertModalMask").css("z-index",20),comm.confirmBox({content:"账号已存在，可直接登录",cancel:"注册新账号",ensure:"登录",ensureCallback:function(){loginAbout.register.exit(),loginAbout.login.show({success:function(){loginAbout.changeHead(),loginAbout.login.exit(),location.reload()}}),$(".ev-phoneNum").val(n.val())},cancelCallback:function(){$(".ev-regNum").attr("value","")}}),e.isValid.phoneIsValid=!1):e.sendCode()}})},checkPassword:function(){var e=this;e.isValid.passIsValid=!0;var n=$(".ev-regPas"),s=/^[0-9a-zA-Z]*$/g,o=s.test(n.val());if(o){var i=n.val().length;i<6?e.isValid.passIsValid=!1:i>20&&(e.isValid.passIsValid=!1)}else e.isValid.passIsValid=!1},checkPassword2:function(){var e=this;e.isValid.passIsValid=!0;var n=$(".ev-regPas"),s=/^[0-9a-zA-Z]*$/g,o=n.val().length,i=s.test(n.val());if(i){var o=n.val().length;o<6?(e.toast("密码长度不足6位",300,1500),e.isValid.passIsValid=!1):o>20&&(e.toast("密码长度超过20位",300,1500),e.isValid.passIsValid=!1)}else e.toast("密码格式不正确",300,1500),e.isValid.passIsValid=!1},checkValidCode:function(){var e=this;e.isValid.codeIsValid=!0,""==$(".ev-regCode").val()&&(e.isValid.codeIsValid=!1)},checkValidCode2:function(){var e=this;e.isValid.codeIsValid=!0,""==$(".ev-regCode").val()&&(e.toast("验证码不能为空",300,1500),e.isValid.codeIsValid=!1)},checkSer:function(){var e=this,n=!0;$(".service i").on("click",function(){n?($(".service i").removeClass("active"),n=!1,e.isValid.server=!1,e.active()):($(".service i").addClass("active"),n=!0,e.isValid.server=!0,e.active())}),e.active()},active:function(){var e=this,n=$(".ev-regNum").val(),s=$(".ev-regPas").val(),o=$(".ev-regCode").val();n&&s&&o&&e.isValid.phoneIsValid&&e.isValid.passIsValid&&e.isValid.codeIsValid&&e.isValid.server?($(".ev-regSave").addClass("activation"),e.regBtn()):($(".ev-regSave").removeClass("activation"),$(".ev-regSave").unbind("click"))},check:function(){var e=this,n=$(".ev-regNum"),s=$(".ev-regPas"),o=$(".ev-regCode");n.on("blur",function(){e.checkPhone2()}),s.on("blur",function(){e.checkPassword2()}),o.on("blur",function(){e.checkValidCode2()}),n.off("keyup").on("keyup",function(){e.checkPhone(),e.active()}),s.off("keyup").on("keyup",function(){e.checkPassword(),e.active()}),o.off("keyup").on("keyup",function(){e.checkValidCode(),e.active()})},sendCode:function(){var e=this;$(".ev-regvalidate").off("click").on("click",function(){var n=$(".ev-regNum").val();e.isValid.sendCodeNum=n;var s=/^(127|128|13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/,o=(s.test(n),60);e.ajaxFn({url:e.path.sendCode,async:!1,param:{account:n,typeId:2,codeLength:4},type:"post",fn:function(n){var s=n.responseObject.responseData.codeNum;if(e.isValid.regcodeKey=n.responseObject.responsePk,s)var i=setInterval(function(){o--,$(".validate").text(o+"s后重新获取"),$(".validate").css("color","#ccc"),$(".validate").unbind("click"),0==o&&(clearTimeout(i),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),e.sendCode()),$(".returnText").off("click").on("click",function(){clearTimeout(i),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),loginAbout.register.show(),loginAbout.login.show(),e.sendCode()}),$(".reg-experiencePo").on("click",function(){commLog.creatEvent({id:14,url:"",keyword:"注册关闭"}),comm.confirmBox({title:"确定放弃注册吗?",content:"放弃注册,将无法拥有以下权限:浏览完整系列课程,参与课程问答。",cancel:"放弃",ensure:"继续注册",ensureCallback:function(){},cancelCallback:function(){loginAbout.login.exit(),clearTimeout(i),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e")}}),e.sendCode()}),$(".log-experiencePo").off("click").on("click",function(){clearTimeout(i),$(".validate").text("点击获取验证码"),$(".validate").css("color","#73859e"),e.sendCode()})},1e3);else e.toast("每日最多获取3次验证码,请明天再试",300,2e3)}})})},regBtn:function(){var e=this;$(".ev-regSave").off("click").on("click",function(){if(commLog.creatEvent({id:11,url:window.location.href,keyword:"注册提交"}),$(this).is(".activation")){var n=$(".ev-regNum").val(),s=$(".ev-regPas").val(),o=$(".ev-regCode").val();e.isValid.phoneNum=n,e.isValid.phoneNum!=e.isValid.sendCodeNum?e.toast("验证码输入错误",300,1500):e.ajaxFn({url:e.path.checkCode,type:"post",async:!1,param:{validCode:o,id:e.isValid.regcodeKey},fn:function(o){var i=o.responseObject.responseStatus,a=o.responseObject.responseCode;i?e.ajaxFn({url:e.path.register,type:"get",param:{account:n,passwd:s,registType:1},fn:function(s){e.isValid.customerId=s.responseObject.responsePk;var o=s.responseObject.responseStatus,i=s.responseObject.responseCode;if(o)loginAbout.register.exit(),localStorage.setItem("userId",e.isValid.customerId),loginAbout.changeHead(),localStorage.setItem("userState","true"),localStorage.setItem("phoneNum",n),localStorage.setItem("unActive","1"),e.objFn.success&&e.objFn.success();else{switch(i){case"9X0003":e.toast("用户名或密码为空");break;case"0B0001":e.toast("用户名已存在")}e.objFn.success&&e.objFn.success()}}}):"1A0002"==a?e.toast("验证码错误,请重新获取",300,1500):"1A0001"==a&&e.toast("验证码已经失效,请重新获取",300,1500)}})}})}};registerFn.init();